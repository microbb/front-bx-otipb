!function(){"use strict";class e{accept(e){return e(this),this}}class t extends e{constructor(e){let{modalSelector:t=null,modalGroup:s="[data-sumbiot-modal]",closeSelector:n="[data-sumbiot-modal-close]",closeClickOverlay:i=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this._trigger=e,this.modal=document.querySelector(t||document.querySelector(e).dataset.sumbiotTarget),this._close=this.modal.querySelector(n),this._modalGroupSelector=s,this._windows=document.querySelectorAll(s),this._closeClickOverlay=i,this._init()}_init(){this.hideAllModals(),this._showHandler(),this._closeHandler()}hideAllModals(){this._windows.forEach((e=>{e.classList.add("animated","fadeIn"),e.style.display="none"}))}_showHandler(){document.addEventListener("click",(e=>{const t=e.target;(t&&t.classList.contains(this._trigger.slice(1))||t&&t.parentElement.classList.contains(this._trigger.slice(1)))&&(e.preventDefault(),e.stopPropagation(),this._show(),setTimeout((()=>{t.blur()}),150))}))}_show(){this.hideAllModals(),this.modal.style.display="block"}_closeHandler(){this._close.addEventListener("click",(e=>{e.target&&(e.preventDefault(),this._closeModal())})),this.modal.addEventListener("click",(e=>{e.target&&(e.stopPropagation(),this._closeModalOverlay(e))})),window.addEventListener("keydown",(e=>{"Escape"!==e.key&&27!==e.keyCode||this._closeModalEscape(e)}))}_closeModal(){this.modal.style.display="none"}_closeModalEscape(e){document.querySelectorAll(this._modalGroupSelector).forEach((e=>{"block"===e.style.display&&(e.style.display="none")}))}_closeModalOverlay(e){e.target===this.modal&&this._closeClickOverlay&&(this.modal.style.display="none")}}class s extends t{static createInput(){const e=document.createElement("input");return e.classList.add("sumbiot-input-dynamic"),e.setAttribute("type","hidden"),e.setAttribute("name","ID"),e}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,t),this._wrapperModalSelector=t.modalWrapper||".sumbiot-wrapper",this._wrapperElementSelector=t.elementWrapper||"[data-sumbiot-wrapper]",this._existsElementForPasteIdSelector=t.existsElementForPasteId}_showHandler(){document.addEventListener("click",(e=>{const t=e.target;t&&t.classList.contains(this._trigger.slice(1))?(e.preventDefault(),this._triggerEvent=t,this._show()):t&&t.parentElement.classList.contains(this._trigger.slice(1))&&(e.preventDefault(),this._triggerEvent=t.parentElement,this._show())}),!0)}_show(){this.hideAllModals(),this._modalPosition(),this.modal.style.display="block"}_modalPosition(){this._elementPosition(),this._triggerEvent.closest(this._wrapperModalSelector)||this._triggerEvent.parentElement.classList.add(this._wrapperModalSelector.slice(1)),this._wpapper=this._triggerEvent.closest(this._wrapperModalSelector),this._wpapper.append(this.modal)}_elementPosition(){let e=this._triggerEvent.dataset.id,t=this.modal.querySelector(this._existsElementForPasteIdSelector||".sumbiot-input-dynamic");t||(t=s.createInput(),this.modal.querySelector(this._wrapperElementSelector)?this.modal.querySelector(this._wrapperElementSelector).prepend(t):this.modal.querySelector("form").prepend(t)),this._existsElementForPasteIdSelector?t.setAttribute("data-sumbiot-id",e):t.setAttribute("value",e)}}class n{accept(e){return e(this),this}}class i extends n{constructor(e){let{headActive:t=null,contentActive:s=null,display:n="block",hideOpen:i=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this._triggerSelector=e,this._headActive=t||"sumbiot-accordion-head",this._contentActive=s||"sumbiot-accordion-content",this._display=n,this._hideOpen=i,this._init()}_init(){this._toggleHandler()}_toggleHandler(){document.addEventListener("click",(e=>{const t=e.target;if(t&&t.closest(this._triggerSelector)){const s=t.closest(this._triggerSelector),n=s.nextElementSibling;this._hideOpen?document.querySelectorAll(this._triggerSelector).forEach((t=>{s===t?this._toggle(s,n,e):(t.classList.remove(this._headActive),t.nextElementSibling.classList.remove(this._contentActive),t.nextElementSibling.style.display="none")})):this._toggle(s,n,e)}}))}_toggle(e,t,s){s.target&&s.preventDefault(),t.style.display=t.style.display===this._display?"none":this._display,e.classList.toggle(this._headActive),setTimeout((()=>{t.classList.toggle(this._contentActive)}))}}class o{accept(e){return e(this),this}}class r extends o{constructor(e){let{dropdownToggleSelector:t=".dropdown-sumbiot__toggle",dropdownOptionsWrapperSelector:s=".dropdown-sumbiot__options",display:n="block"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this._dropdownSelector=e,this._dropdownToggleSelector=t,this._listDropdowns=document.querySelectorAll(e),this._listDropdownsOptions=document.querySelectorAll(s),this._display=n,this._init()}_init(){this.hideAllDropdowns(),this._toggleHandler()}hideAllDropdowns(){this._listDropdownsOptions.forEach((e=>{this._target?this._target.nextElementSibling!==e&&(e.style.display="none"):e.style.display="none"}))}_toggleHandler(){this._listDropdowns.forEach((e=>{e.addEventListener("click",(e=>{e.target&&e.target.classList.contains(this._dropdownToggleSelector.slice(1))&&(e.preventDefault(),this._target=e.target,this._toggleOptions())}))}))}_toggleOptions(){this.hideAllDropdowns(),this._target.nextElementSibling.style.display="none"===this._target.nextElementSibling.style.display?this._display:"none"}}class a extends r{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,t),this._dropdownOptionSelector=t.dropdownOptionSelector||"[data-select-option]"}_toggleHandler(){this._listDropdowns.forEach((e=>{this._initInput(e),e.addEventListener("click",(t=>{t.target&&t.target.classList.contains(this._dropdownToggleSelector.slice(1))?(t.preventDefault(),this._target=t.target,this._toggleOptions()):t.target&&t.target.matches(this._dropdownOptionSelector)&&(t.preventDefault(),this.select(e,t.target))}))})),document.addEventListener("click",(e=>{e.target&&!e.target.closest(this._dropdownSelector)&&this._listDropdownsOptions.forEach((e=>{e.style.display="none"}))}),!0)}select(e,t){const s=e.querySelectorAll(this._dropdownOptionSelector),n=e.querySelector(this._dropdownToggleSelector);s.forEach((e=>{e.style.backgroundColor=""})),t.style.backgroundColor="#e7e7e7",n.innerHTML=t.innerText,t.getAttribute("title")?n.setAttribute("title",t.getAttribute("title")):n.removeAttribute("title"),n.nextElementSibling.style.display="none",e.previousElementSibling.setAttribute("value",t.dataset.selectOption)}_initInput(e){const t=document.createElement("input");t.classList.add("sumbiot-input-select"),t.setAttribute("type","hidden"),t.setAttribute("name",e.dataset.selectName),t.setAttribute("value",""),e.insertAdjacentElement("beforebegin",t)}reset(e){const t=e.querySelectorAll(this._dropdownToggleSelector),s=e.querySelectorAll(this._dropdownOptionSelector),n=e.querySelectorAll(".sumbiot-input-select");t.forEach((e=>{e.innerText="",e.removeAttribute("title")})),s.forEach((e=>{e.style.backgroundColor=""})),n.forEach((e=>{e.setAttribute("value","")}))}}class l extends r{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,t),this._dropdownOptionSelector=t.dropdownOptionSelector||"[data-input-search-option]"}_init(){this.hideAllDropdowns(),this._searchHandler()}hideAllDropdowns(){this._listDropdownsOptions.forEach((e=>{e.style.display="none"}))}_searchHandler(){this._listDropdowns.forEach((e=>{e.addEventListener("input",(e=>{e.target&&e.target.classList.contains(this._dropdownToggleSelector.slice(1))&&(e.preventDefault(),this._showOptionsWrapper(e.target))})),e.addEventListener("click",(t=>{t.target&&t.target.matches(this._dropdownOptionSelector)&&(t.preventDefault(),this._activeInput(e,t.target))}))})),document.addEventListener("click",(e=>{e.target&&!e.target.closest(this._dropdownSelector)&&this.hideAllDropdowns()}),!0)}_showOptionsWrapper(e){let t=!1,s=e.value.trim();s&&s.length>2?(Array.from(document.querySelectorAll(`${this._dropdownSelector} ${this._dropdownOptionSelector}`)).forEach((e=>{e.innerText.toUpperCase().includes(s.toUpperCase())?(e.style.display=this._display,t=!0):e.style.display="none"})),e.nextElementSibling.style.display=t?this._display:"none"):e.nextElementSibling.style.display="none"}_activeInput(e,t){e.querySelector(this._dropdownToggleSelector).value=t.innerText,this.hideAllDropdowns()}}class c{constructor(e){let{}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.$el=document.querySelector(e),this._init()}_init(){}hide(){this.$el.style.display="none",this._onHide()}show(){this.$el.style.display="block",this._onShow()}_onHide(){}_onShow(){}}class d{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.form=e,this.controls=t}value(){const e={};return Object.keys(this.controls).forEach((t=>{e[t]=this.form[t].value})),e}isValid(){let e=!0;return Object.keys(this.controls).forEach((t=>{if(this.controls[t].length){const s=this.controls[t];let n=!0;s.forEach((e=>{n=e(this.form[t].value)&&n})),n?u(this.form[t]):function(e){u(e);e.nextElementSibling.firstElementChild.style.backgroundColor="#fff5f5",e.previousElementSibling.insertAdjacentHTML("beforeend",'<span class="form__validation-error">Введите значение</span>')}(this.form[t]),e=e&&n}})),e}clear(){this.form.reset()}}function u(e){e.nextElementSibling.firstElementChild.style.backgroundColor="",e.previousElementSibling.querySelector(".form__validation-error")&&e.previousElementSibling.querySelector(".form__validation-error").remove()}class p{static required(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e&&e.trim()}static minLength(e){return t=>t.length>=e}}const h=new class{constructor(e){this.componentBx=e}async useRequest(e,t){try{return await BX.ajax.runComponentAction(this.componentBx,e,{mode:"class",data:t})}catch(e){if("error"===e.status)throw{functionName:"useRequest",...e};throw e}}async getUsers(){try{return(await BX.ajax.runComponentAction(this.componentBx,"getUsers",{mode:"class"})).data.result}catch(e){if("error"===e.status)throw{functionName:"getUsers",...e};throw e}}async getFio(){const e=await BX.ajax.runComponentAction(this.componentBx,"getFio",{mode:"class"});return JSON.parse(e.data.result)}async getAccessAdmin(){try{return(await BX.ajax.runComponentAction(this.componentBx,"getAccessAdmin",{mode:"class"})).data.result}catch(e){if("error"===e.status)throw{functionName:"getAccessAdmin",...e};throw e}}}("bizproc:otipb.new");class m{constructor(e){let{selectorA:t="[data-sumbiot-selectA]",selectATriggerSelector:s=".dropdown__item",callAction:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{selectorB:i="[data-sumbiot-selectB]",resetParams:o={activeOption:".js-dropdown__toggle",options:".dropdown__item",input:".sumbiot-input-select"},renderTemplate:r,selectorWherePasteOptions:a="[data-sumbiot-selectB-paste]"}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.$form=e.tagName?e:document.querySelector(e),this.$selectA=this.$form.querySelector(t),this.selectATriggerSelector=s,this.callActionA=n,this.$selectB=this.$form.querySelector(i),this.$pasteOptions=this.$selectB.querySelector(a),this.resetParamsB=o,this.renderTemplateB=r,this._init()}_init(){this._handlerEvent()}_handlerEvent(){this.$selectA.addEventListener("click",(e=>{let t=e.target;(t&&t.classList.contains(this.selectATriggerSelector.slice(1))||t&&t.parentElement.classList.contains(this.selectATriggerSelector.slice(1)))&&(e.preventDefault(),t.parentElement.classList.contains(this.selectATriggerSelector.slice(1))&&(t=t.parentElement),this.fillSelectB(t))}))}async fillSelectB(e){try{let t=e.dataset.selectOption,s=new FormData;s.append("id",t),this._resetSelectB();const n=await h.useRequest(this.callActionA,s),i=JSON.parse(n.data.result);if(Array.isArray(i)&&i.length){let e=i.map((e=>this.renderTemplateB(e)));this.$pasteOptions.insertAdjacentHTML("afterbegin",e.join(""))}else console.error("In file ChainingSelectInFormPlugin, in function fillSelectB, response is either not an array or an empty array")}catch(e){"error"===e.status?(console.group(`In file ApiService, in function , ${this.callActionA} promise return reject`),console.group("List of errors"),e.errors.forEach((e=>{console.error(`Name: ${e.message}\n Code: ${e.code}\n customData: ${e.customData}`)})),console.groupEnd(),console.groupEnd()):(console.group("In file ChainingSelectInFormPlugin, in function fillSelectB error"),console.error(`${e.stack}`),console.groupEnd())}}_resetSelectB(){let e=this.$selectB.querySelector(this.resetParamsB.activeOption),t=this.$selectB.querySelectorAll(this.resetParamsB.options),s=this.$selectB.parentElement.querySelector(this.resetParamsB.input);e.innerText="",e.removeAttribute("title"),t.forEach((e=>{e.remove()})),s.setAttribute("value","")}deleteOptions(){this.$selectB.querySelectorAll(this.resetParamsB.options).forEach((e=>{e.remove()}))}}class g{constructor(){let{loading:e="Загрузка...",success:t="Успех",failure:s="Неудача",activeClass:n=""}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.message={loading:{title:e,img:""},success:{title:t,img:"loader__img--ok"},failure:{title:s,img:"loader__img--error"}},this.activeClass=n,this._init()}_init(){this.$el=document.createElement("div"),this.$el.classList.add("loader"),this.activeClass&&this.$el.classList.add(this.activeClass),this.$el.innerHTML=`\n      <div class="loader__img"></div>\n      <p class="loader__massage">${this.message.loading.title}</p>\n    `,this.$img=this.$el.querySelector(".loader__img"),this.$massage=this.$el.querySelector(".loader__massage")}loading(){return this.$el}success(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.$img.classList.add(this.message.success.img),this.$massage.innerHTML=e||this.message.success.title}failure(){this.$img.classList.add(this.message.failure.img),this.$massage.innerHTML=this.message.failure.title}removeLoader(){this.$el.remove()}}function _(e){let{ID:t,NAME:s}=e;return`\n    <div class="dropdown__item" data-select-option="${t}" title="${s}">\n      ${s}\n    </div>\n  `}class f extends c{constructor(e,t){super(e,t),this.instanceDropDown=t.dropDown||{},this.partners=t.partners||[]}_init(){this.$el.addEventListener("submit",v.bind(this)),this.form=new d(this.$el,{E_FIO:[],ID_DIVISION:[p.required],ID_DEPARTMENT:[p.required],ID_MATRIX_WORKS:[p.required],E_EMPLOYEE_STATUS:[p.required]}),this.chainSelect=new m(this.$el,{callAction:"getDepartments"},{renderTemplate:_})}}async function v(e){if(e.preventDefault(),this.form.isValid()){const e=new g({loading:"Идет добавления сотрудника",success:"Сотрудник добавлен",failure:"Сотрудник не добавлен"});try{const t=this.$el.getAttribute("action").slice(1),s=new FormData(this.$el),n=this.partners.find((e=>"mainResult"===e.name)),i=document.querySelector(".js-options-search");this.$el.append(e.loading());const o=await h.useRequest(t,s),r=JSON.parse(o.data.result);e.success(),this.partners.forEach((e=>e.component.hide())),n.component.unshift(r).show(),i.append(function(e){let t=document.createElement("div"),s=document.createTextNode(e);return t.append(s),t.classList.add("dropdown__item"),t.setAttribute("title",e),t.style.display="none",t}(r.fio))}catch(t){e.failure(),"error"===t.status?(console.group("In file ApiService, in function useRequest, promise return reject"),console.group("List of errors"),t.errors.forEach((e=>{console.error(`Name: ${e.message}\n Code: ${e.code}\n customData: ${e.customData}`)})),console.groupEnd(),console.groupEnd()):(console.group("In file FormAddUserComponent error"),console.error(`${t.stack}`),console.groupEnd())}finally{setTimeout((()=>{this.form.clear(),this.instanceDropDown.reset(this.form.form),this.chainSelect.deleteOptions(),e.removeLoader()}),900)}}}class b extends c{constructor(e,t){super(e,t),this.instanceDropDown=t.dropDown||{},this.partners=t.partners||[]}_init(){this.$el.addEventListener("submit",E.bind(this)),this.$el.addEventListener("reset",y.bind(this)),this.form=new d(this.$el,{DATE_BEGIN:[],DATE_END:[],ID_DIVISION:[],ID_MATRIX_WORKS:[],ID_PROGRAM:[]})}}async function E(e){if(e.preventDefault(),e.target.querySelector(".form__button--submit").blur(),this.form.isValid()){const e=new g({loading:"Идет фильтрация данных",failure:"Ошибка"});try{const t=this.$el.getAttribute("action").slice(1),s=new FormData(this.$el),n=this.partners.find((e=>"filterResult"===e.name));this.$el.append(e.loading());const i=await h.getAccessAdmin(),o=await h.useRequest(t,s),r=JSON.parse(o.data.result),a=r.length||0;e.success(`Найдено: ${a} совпадений`),this.partners.forEach((e=>e.component.hide())),n.component.register(r,{isAccess:i}).show()}catch(t){e.failure(),"error"===t.status?(console.group(`In file ApiService, in function ${t.functionName}, promise return reject`),console.group("List of errors"),t.errors.forEach((e=>{console.error(`Name: ${e.message}\n Code: ${e.code}\n customData: ${e.customData}`)})),console.groupEnd(),console.groupEnd()):(console.group("In file FormFilterComponent error"),console.error(`${t.stack}`),console.groupEnd())}finally{setTimeout((()=>{e.removeLoader()}),900)}}}function y(e){setTimeout((()=>{e.target.querySelector(".form__button--reset_filter").blur()}),150),this.instanceDropDown.reset(this.form.form),this.partners.forEach((e=>e.component.hide())),this.partners.find((e=>"mainResult"===e.name)).component.show()}class w{static removeClass(e,t){document.querySelectorAll(e).forEach((e=>{e.classList.remove(...t)}))}static addClosestClass(e,t,s){e.closest(t).classList.add(...s)}static removeClosestClass(e,t,s){e.closest(t).classList.remove(...s)}}function $(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?arguments.length>2&&void 0!==arguments[2]?arguments[2]:"":arguments.length>1&&void 0!==arguments[1]?arguments[1]:""}function S(e){let{idUser:t,fio:s,division:n,department:i,work:o,status:r}=e,{build:a=0,isAccess:l=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return`\n    <div class="col-1" title="ID: ${t}" data-id="${t}" data-sumbiot-page-counter></div>\n    <div class="col-2" title="Отдел: ${i||"не заполнено"}">\n      <span class="result__clip text-align-center">\n        ${n||"не заполнено"}\n      </span>\n    </div>\n    <div class="col-3 g-justify-items-left" title="${s||"не заполнено"}">\n      <span class="result__clip">\n        ${s||"не заполнено"}\n      </span>\n    </div>\n    ${1===a||2===a?`\n        <div class="col-4 g-justify-items-left js-matrix-work-hse" title="${o||"не заполнено"}">\n          <span class="result__clip">\n            ${o||"не заполнено"}\n          </span>\n        </div>\n      `:`\n        <div class="col-4 js-matrix-work-hse">\n          <span class="p-relative d-inline-block">\n            <button class="button button--icon js-add-hse-modal" type="button" data-sumbiot-target="#add-hse-modal" data-id="${t}" title="${$(l,"Нет прав доступа","Добавить должность HSE")}" ${$(l,"disabled")}>\n              <img class="result__img" src="${BX.message("TemplateFolder")}/assets/img/add-document-icon.svg" width="18" height="18" alt="">\n            </button>\n          </span>\n        </div>\n      `}\n    <div class="col-1">${r||"не заполнено"}</div>\n    <div class="col-1">\n      <button class="result__options-arrow button button--arrow" type="button" title="Подробно"></button>\n    </div>\n  `}function A(e){return`\n    <div class="result__row result__row--inner">\n      <div class="row gx-0">\n        <div class="col-12">\n              ${e}\n        </div>\n      </div>\n    </div>\n  `}function L(e){let{idUser:t,cards:s,training:n,customUser:i}=e,{build:o=0,isAccess:r=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return`\n    <div class="result__info-box">\n      <div class="result__info-title">\n        Удостоверение действующие\n\n        <div class="result__info-options">\n          ${1===o?`\n        <button class="result__info-options-btn button button--icon js-edit-user-modal" type="button" data-sumbiot-target="#edit-user-modal" data-id="${t}" title="${$(r,"Нет прав доступа","Редактировать сотрудника")}" ${$(r,"disabled")}>\n          <img class="result__img" src="${BX.message("TemplateFolder")}/assets/img/edit-user-icon.svg" width="22" height="22" alt="">\n        </button>\n        <span class="p-relative d-inline-block">\n          <button class="result__info-options-btn button button--icon js-delete-user-and-card-modal" type="button" data-sumbiot-target="#delete-user-or-card-modal" data-id="${t}" data-action="/deleteUser" title="${$(r,"Нет прав доступа","Удалить сотрудника")}" ${$(r,"disabled")}>\n            <img class="result__img" src="${BX.message("TemplateFolder")}/assets/img/remove-user-icon.svg" width="22" height="22" alt="">\n          </button>\n        </span>\n      `:2===o?`\n        <button class="result__info-options-btn button button--icon js-edit-hse-modal" type="button" data-sumbiot-target="#edit-hse-modal" data-id="${t}" title="${$(r,"Нет прав доступа","Изменить должность HSE")}" ${$(r,"disabled")}>\n          <img class="result__img" src="${BX.message("TemplateFolder")}/assets/img/edit-document-icon.svg" width="22" height="22" alt="">\n        </button>\n      `:""}\n        </div>\n      </div>\n\n      <div class="result__info-box-inner">\n\n        <div class="result__row result__row--inner result__row--inner-header">\n          <div class="row gx-0">\n            <div class="col-5">Программа обучения</div>\n            <div class="col-3">Номер документа</div>\n            <div class="col-2">Дата след. аттестации</div>\n            <div class="col-2">Опции</div>\n          </div>\n        </div>\n\n        ${s&&s.NORMAL_DATE?s.NORMAL_DATE.map((e=>function(e,t){let{idCard:s,programName:n,cardNumber:i,attestationDate:o,nextAttestationDate:r}=e,{idUser:a=null,customUser:l=null,isAccess:c=!0}=t;return`\n    <div class="result__row result__row--inner">\n      <div class="row gx-0">\n        <div class="col-5 g-justify-items-left" title="${n||"не заполнено"}">\n          <span class="result__clip">\n            ${n||"не заполнено"}\n          </span>\n        </div>\n        <div class="col-3" title="Номер документа: ${i||"не заполнено"}&#10Дата аттестации: ${o||"не заполнено"}">\n          <span class="result__clip text-align-center">\n            ${i||"не заполнено"}\n          </span>\n        </div>\n        <div class="col-2">${r||"не заполнено"}</div>\n        <div class="col-2">\n          <span class="result__options-card">\n            <button class="button button--text js-edit-card-modal js-edit-card" type="button" data-sumbiot-target="#edit-card-modal" data-id="${s}" data-id-user="${a}" data-custom-user="${l}" data-action="/editCard" title="${$(c,"Нет прав доступа")}" ${$(c,"disabled")}>Редактировать</button>\n            <span class="p-relative d-inline-block">\n              <button class="button button--text button--img-delete js-delete-user-and-card-modal" type="button" data-sumbiot-target="#delete-user-or-card-modal" data-id="${s}" data-id-user="${a}" data-custom-user="${l}" data-action="/deleteCard" title="${$(c,"Нет прав доступа","Удалить удостоверение")}" ${$(c,"disabled")}></button>\n            </span>\n          </span>\n        </div>\n      </div>\n    </div>\n  `}(e,{idUser:t,customUser:i,isAccess:r}))).join(" "):A("Нет удостоверений")}\n\n      </div>\x3c!--.result__info-box-inner--\x3e\n\n    </div>\x3c!--./result__info-box--\x3e\n\n    <div class="result__info-box">\n      <div class="result__info-title">Доступные обучения</div>\n\n      <div class="result__info-box-inner">\n\n        <div class="result__row result__row--inner result__row--inner-header">\n          <div class="row gx-0">\n            <div class="col-9">Программа обучения</div>\n            <div class="col-3">Опции</div>\n          </div>\n        </div>\n\n        ${n&&n.length?n.map((e=>function(e,t){let{ID:s,NAME:n}=e,{idUser:i=null,customUser:o=null,isAccess:r=!0}=t;return`\n    <div class="result__row result__row--inner">\n      <div class="row gx-0">\n        <div class="col g-justify-items-left" title="${n||"не заполнено"}">\n          <span class="result__clip">\n            ${n||"не заполнено"}\n          </span>\n        </div>\n        <div class="col-3">\n          <button class="button button--text js-edit-card-modal" type="button" data-sumbiot-target="#edit-card-modal" data-id="${s}" data-id-user="${i}" data-custom-user="${o}" data-action="/addCard" title="${$(r,"Нет прав доступа")}" ${$(r,"disabled")}>Добавить</button>\n        </div>\n      </div>\n    </div>\n  `}(e,{idUser:t,customUser:i,isAccess:r}))).join(" "):A("Нет обучений")}\n\n      </div>\x3c!--.result__info-box-inner--\x3e\n\n    </div>\x3c!--./result__info-box--\x3e\n\n    <div class="result__info-box">\n      <div class="result__info-title">Удостоверение на переаттестации</div>\n\n      <div class="result__info-box-inner">\n\n        <div class="result__row result__row--inner result__row--inner-header">\n          <div class="row gx-0">\n            <div class="col-9">Программа обучения</div>\n            <div class="col-3">Опции</div>\n          </div>\n        </div>\n\n        ${s&&s.OVER_DATE?s.OVER_DATE.map((e=>function(e,t){let{idCard:s,programName:n,cardNumber:i,nextAttestationDate:o}=e,{idUser:r=null,customUser:a=null,isAccess:l=!0}=t;return`\n    <div class="result__row result__row--inner">\n      <div class="row gx-0">\n        <div class="col-9 g-justify-items-left" title="${n||"не заполнено"}.&#10Номер документа: ${i||"не заполнено"}&#10Аттестация закончилась: ${o||"не заполнено"}">\n          <span class="result__clip">\n            ${n||"не заполнено"}\n          </span>\n        </div>\n        <div class="col-3">\n          <span class="result__options-card">\n            <button class="button button--text js-edit-card-modal js-edit-card" type="button" data-sumbiot-target="#edit-card-modal" data-id="${s}" data-id-user="${r}" data-custom-user="${a}" data-action="/editCard" title="${$(l,"Нет прав доступа")}" ${$(l,"disabled")}>Продлить</button>\n            <span class="p-relative d-inline-block">\n              <button class="button button--text button--img-delete js-delete-user-and-card-modal" type="button" data-sumbiot-target="#delete-user-or-card-modal" data-id="${s}" data-id-user="${r}" data-custom-user="${a}" data-action="/deleteCard" title="${$(l,"Нет прав доступа","Удалить удостоверение")}" ${$(l,"disabled")}></button>\n            </span>\n          </span>\n        </div>\n      </div>\n    </div>\n  `}(e,{idUser:t,customUser:i,isAccess:r}))).join(" "):A("Нет удостоверений")}\n\n      </div>\x3c!--.result__info-box-inner--\x3e\n\n    </div>\x3c!--./result__info-box--\x3e\n  `}class D extends c{constructor(e,t){super(e,t),this.instanceDropDown=t.dropDown||{}}_init(){this.$el.addEventListener("submit",C.bind(this)),document.addEventListener("click",(e=>{let t=e.target;(t&&t.classList.contains("js-edit-user-modal")||t.parentElement.classList.contains("js-edit-user-modal"))&&(e.preventDefault(),t.parentElement.classList.contains("js-edit-user-modal")&&(t=t.parentElement),x.call(this,t))})),this.form=new d(this.$el,{ID:[],E_FIO:[],ID_DIVISION:[p.required],ID_DEPARTMENT:[p.required],ID_MATRIX_WORKS:[p.required],E_EMPLOYEE_STATUS:[p.required]}),this.chainSelect=new m(this.$el,{callAction:"getDepartments"},{renderTemplate:_})}}async function x(e){let t;const s=new g({loading:"Идет сбор данных, о сотруднике"});try{const n=new FormData,i=this.$el.querySelector(".js-edit-fio"),o=Array.from(this.$el.querySelectorAll("[data-sumbiot-selectA] .dropdown__item"));n.append("ID",e.dataset.id),t=setTimeout((()=>{this.$el.append(s.loading())}),400);const r=await h.useRequest("getUserInfo",n),a=JSON.parse(r.data.result),l=o.find((e=>e.dataset.selectOption===a.ID_DIVISION));await this.chainSelect.fillSelectB(l),this.instanceDropDown.select(this.chainSelect.$selectA,l),i.value=a.fio,delete a.fio,delete a.ID_DIVISION;const c=Object.values(a);this.$el.querySelectorAll(".dropdown__item:not([data-sumbiot-selectA])").forEach((e=>{c.includes(e.dataset.selectOption)&&e.click()}))}catch(e){"error"===e.status?(console.group("In file ApiService, in function useRequest, promise return reject"),console.group("List of errors"),e.errors.forEach((e=>{console.error(`Name: ${e.message}\n Code: ${e.code}\n customData: ${e.customData}`)})),console.groupEnd(),console.groupEnd()):(console.group("In file FormEditUserComponent, in function getData error"),console.error(`${e.stack}`),console.groupEnd())}finally{clearTimeout(t),s.removeLoader()}}async function C(e){if(e.preventDefault(),this.form.isValid()){const e=new g({loading:"Идет добавления сотрудника",success:"Сотрудник добавлен",failure:"Сотрудник не добавлен"});try{const t=this.$el.getAttribute("action").slice(1),s=new FormData(this.$el);this.$el.append(e.loading());const n=await h.useRequest(t,s),i=JSON.parse(n.data.result),o=S(i,{build:1}),r=L(i,{build:1});e.success(),setTimeout((()=>{const e=this.$el.closest(".result__row"),t=e.querySelector(".js-user-info"),s=e.querySelector(".result__info");t.innerHTML=o,s.innerHTML=r}),900)}catch(t){e.failure(),"error"===t.status?(console.group("In file ApiService, in function useRequest, promise return reject"),console.group("List of errors"),t.errors.forEach((e=>{console.error(`Name: ${e.message}\n Code: ${e.code}\n customData: ${e.customData}`)})),console.groupEnd(),console.groupEnd()):(console.group("In file FormEditUserComponent, in function submitHandler error"),console.error(`${t.stack}`),console.groupEnd())}finally{setTimeout((()=>{this.form.clear(),this.instanceDropDown.reset(this.form.form),this.chainSelect.deleteOptions(),this.$el.closest(".modal").style.display="none",w.removeClass(".js-wrapper-modal",["result__info--min_height-380","result__info--min_height-442","result__info--min_height-265"]),e.removeLoader()}),900)}}}class q extends c{constructor(e,t){super(e,t),this.partners=t.partners||[]}_init(){this.$el.addEventListener("submit",I.bind(this)),this.form=new d(this.$el,{ID:[]})}}async function I(e){if(e.preventDefault(),this.form.isValid()){const e=new g({loading:"Удаление",success:"Удален",failure:"Неудача",activeClass:"loader--delete"});try{const t=this.$el.getAttribute("action").slice(1),s=new FormData(this.$el);this.$el.append(e.loading());const n=await h.useRequest(t,s);if("deleteUser"===t&&(e.success(),setTimeout((()=>{const e=this.$el.closest(".result__row").querySelector("[data-sumbiot-page-counter]").dataset.id;this.partners.forEach((t=>t.component.removeElementInArray(e)))}),900)),"deleteCard"===t){const t=JSON.parse(n.data.result),s=+t.customUser?L(t,{build:1}):+t.idMatrixWorks?L(t,{build:2}):L(t,{build:0});e.success(),setTimeout((()=>{this.$el.closest(".js-result-row").querySelector(".result__info").innerHTML=s}),900)}}catch(t){e.failure(),"error"===t.status?(console.group("In file ApiService, in function useRequest, promise return reject"),console.group("List of errors"),t.errors.forEach((e=>{console.error(`Name: ${e.message}\n Code: ${e.code}\n customData: ${e.customData}`)})),console.groupEnd(),console.groupEnd()):(console.group("In file FormDeleteUserOrCardComponent, in function submitHandler error"),console.error(`${t.stack}`),console.groupEnd())}finally{setTimeout((()=>{this.$el.closest(".modal").style.display="none",e.removeLoader()}),900)}}}class T extends c{constructor(e,t){super(e,t)}_init(){this.$el.addEventListener("submit",k.bind(this)),document.addEventListener("click",(e=>{let t=e.target;(t&&t.classList.contains("js-edit-card-modal")||t.parentElement.classList.contains("js-edit-card-modal"))&&(e.preventDefault(),t.parentElement.classList.contains("js-edit-card-modal")&&(t=t.parentElement),this.form.clear()),(t&&t.classList.contains("js-edit-card")||t.parentElement.classList.contains("js-edit-card"))&&(e.preventDefault(),t.parentElement.classList.contains("js-edit-card")&&(t=t.parentElement),j.call(this,t))})),this.form=new d(this.$el,{ID:[],C_ATTESTATION_DATE:[],C_NEXT_ATTESTATION_DATE:[],C_CARD_NUMBER:[]})}}async function j(e){let t;const s=new g({loading:"Идет сбор данных, об удостоверение"});try{const n=new FormData,i=this.$el.querySelector(".js-edit-att-date"),o=this.$el.querySelector(".js-edit-next-att-date"),r=this.$el.querySelector(".js-edit-card-number");n.append("ID",e.dataset.id),t=setTimeout((()=>{this.$el.append(s.loading())}),400);const a=await h.useRequest("getCard",n),l=JSON.parse(a.data.result);i.value=l.attestationDate,o.value=l.nextAttestationDate,r.value=l.cardNumber}catch(e){"error"===e.status?(console.group("In file ApiService, in function useRequest, promise return reject"),console.group("List of errors"),e.errors.forEach((e=>{console.error(`Name: ${e.message}\n Code: ${e.code}\n customData: ${e.customData}`)})),console.groupEnd(),console.groupEnd()):(console.group("In file FormAddOrEditCardComponent, in function getData error"),console.error(`${e.stack}`),console.groupEnd())}finally{clearTimeout(t),s.removeLoader()}}async function k(e){if(e.preventDefault(),this.form.isValid()){let e;"addCard"===this.$el.getAttribute("action").slice(1)?e=new g({loading:"Добавление удостоверения",success:"Удостоверение добавлено",failure:"Удостоверение не добавлено"}):"editCard"===this.$el.getAttribute("action").slice(1)&&(e=new g({loading:"Редактирование удостоверения",success:"Удостоверение отредактировано",failure:"Удостоверение не отредактировано"}));try{const t=this.$el.getAttribute("action").slice(1),s=new FormData(this.$el);this.$el.append(e.loading());const n=await h.useRequest(t,s),i=JSON.parse(n.data.result),o=+i.customUser?L(i,{build:1}):+i.idMatrixWorks?L(i,{build:2}):L(i,{build:0});e.success(),setTimeout((()=>{this.$el.closest(".result__row").querySelector(".result__info").innerHTML=o}),900)}catch(t){e.failure(),"error"===t.status?(console.group("In file ApiService, in function useRequest, promise return reject"),console.group("List of errors"),t.errors.forEach((e=>{console.error(`Name: ${e.message}\n Code: ${e.code}\n customData: ${e.customData}`)})),console.groupEnd(),console.groupEnd()):(console.group("In file FormAddOrEditCardComponent, in function submitHandler error"),console.error(`${t.stack}`),console.groupEnd())}finally{setTimeout((()=>{this.form.clear(),this.$el.closest(".modal").style.display="none",w.removeClass(".js-wrapper-modal",["result__info--min_height-380","result__info--min_height-442","result__info--min_height-265"]),e.removeLoader()}),900)}}}class O extends c{constructor(e,t){super(e,t)}_init(){this.$el.addEventListener("submit",R.bind(this)),"edit-hse"===this.$el.getAttribute("id")&&document.addEventListener("click",(e=>{let t=e.target;(t&&t.classList.contains("js-edit-hse-modal")||t.parentElement.classList.contains("js-edit-hse-modal"))&&(e.preventDefault(),t.parentElement.classList.contains("js-edit-hse-modal")&&(t=t.parentElement),M.call(this,t))})),this.form=new d(this.$el,{ID:[],ID_MATRIX_WORKS:[p.required]})}}async function M(e){let t;const s=new g({loading:"Идет сбор данных, о сотруднике"});try{const n=new FormData,i=this.$el.querySelectorAll(".dropdown__item");n.append("ID",e.dataset.id),t=setTimeout((()=>{this.$el.append(s.loading())}),400);const o=await h.useRequest("getIdHse",n);i.forEach((e=>{+e.dataset.selectOption==+o.data.result&&e.click()}))}catch(e){"error"===e.status?(console.group("In file ApiService, in function useRequest, promise return reject"),console.group("List of errors"),e.errors.forEach((e=>{console.error(`Name: ${e.message}\n Code: ${e.code}\n customData: ${e.customData}`)})),console.groupEnd(),console.groupEnd()):(console.group("In file FormAddOrEditHseComponent, in function getData error"),console.error(`${e.stack}`),console.groupEnd())}finally{clearTimeout(t),s.removeLoader()}}async function R(e){if(e.preventDefault(),this.form.isValid()){const e=new g({loading:"Добавление должности",success:"Должность добавлена",failure:"Должность не добавлена"});try{const t=this.$el.getAttribute("action").slice(1),s=new FormData(this.$el);this.$el.querySelector("button").blur(),this.$el.append(e.loading());const n=await h.useRequest(t,s),i=JSON.parse(n.data.result),o=L(i,{build:2}),r=`\n    <span class="result__clip">\n      ${i.work}\n    </span>\n  `;e.success(),setTimeout((()=>{const e=this.$el.closest(".result__row"),t=e.querySelector(".result__info"),s=e.querySelector(".js-matrix-work-hse");t.innerHTML=o,s.classList.add("g-justify-items-left"),s.setAttribute("title",i.work),s.innerHTML=r}),900)}catch(t){e.failure(),"error"===t.status?(console.group("In file ApiService, in function useRequest, promise return reject"),console.group("List of errors"),t.errors.forEach((e=>{console.error(`Name: ${e.message}\n Code: ${e.code}\n customData: ${e.customData}`)})),console.groupEnd(),console.groupEnd()):(console.group("In file FormAddOrEditHseComponent, in function submitHandler error"),console.error(`${t.stack}`),console.groupEnd())}finally{setTimeout((()=>{this.$el.closest(".modal").style.display="none",w.removeClass(".js-wrapper-modal",["result__info--min_height-380","result__info--min_height-442","result__info--min_height-265"]),e.removeLoader()}),900)}}}class U extends c{constructor(e,t){super(e,t),this.partners=t.partners||[]}_init(){this.$el.addEventListener("submit",N.bind(this)),this.form=new d(this.$el,{SEARCH:[],STATUS:[]}),H.call(this)}}async function H(){try{const e=this.$el.querySelector(".js-options-search"),t=await h.getFio();if(Array.isArray(t)){let s=t.map((e=>`\n          <div class="dropdown__item" title="${e}" style="display: none">\n            ${e}\n          </div>\n        `));e.innerHTML="",e.insertAdjacentHTML("afterbegin",s.join(""))}}catch(e){"error"===e.status?(console.group("In file ApiService, in function getUsers, promise return reject"),console.group("List of errors"),e.errors.forEach((e=>{console.error(`Name: ${e.message}\n Code: ${e.code}\n customData: ${e.customData}`)})),console.groupEnd(),console.groupEnd()):(console.group("In file SearchComponent, in function getData error"),console.error(`${e.stack}`),console.groupEnd())}}async function N(e){e.preventDefault();let t=e.target.querySelector(".js-button-search-submit");if(t.disabled=!0,setTimeout((()=>{t.blur()}),150),this.form.isValid()){const e=new g({loading:"Идет поиск сотрудника",failure:"Ошибка",activeClass:"loader--min-height"});try{const t=this.$el.getAttribute("action").slice(1),s=new FormData(this.$el),n=this.partners.find((e=>"searchResult"===e.name));this.$el.querySelector(".form__button--reset_search")?.remove(),this.partners.forEach((e=>e.component.hide())),document.querySelector(".result").append(e.loading());const i=await h.getAccessAdmin(),o=await h.useRequest(t,s),r=JSON.parse(o.data.result),a=r.length||0,l=P.call(this);e.success(`Найдено: ${a} совпадений`),a?n.component.register(r,{isAccess:i}).show():n.component.register(r,{bntNext:l,isAccess:i}).show(),this.$el.querySelector(".dropdown--input")?.append(F.call(this))}catch(t){e.failure(),"error"===t.status?(console.group(`In file ApiService, in function ${t.functionName}, promise return reject`),console.group("List of errors"),t.errors.forEach((e=>{console.error(`Name: ${e.message}\n Code: ${e.code}\n customData: ${e.customData}`)})),console.groupEnd(),console.groupEnd()):(console.group("In file FormSearchComponent error"),console.error(`${t.stack}`),console.groupEnd())}finally{setTimeout((()=>{e.removeLoader(),t.disabled=!1}),900)}}}function F(){const e=s=>{s.preventDefault(),s.stopPropagation(),this.form.clear(),this.$el.querySelector(".dropdown__toggle").style.paddingRight="",t.removeEventListener("click",e),t.remove(),this.partners.forEach((e=>e.component.hide())),this.partners.find((e=>"mainResult"===e.name)).component.show()},t=(()=>{let e=document.createElement("button");return e.classList.add("form__button","form__button--reset_search"),e.setAttribute("type","reset"),e})();return this.$el.querySelector(".dropdown__toggle").style.paddingRight="30px",t.addEventListener("click",e),t}function P(){let e=document.createElement("button"),t=document.createTextNode("на главную");return e.append(t),e.classList.add("button","button--text"),e.style.marginLeft="10px",e.addEventListener("click",(()=>{this.$el.querySelector(".dropdown__toggle")&&(this.$el.querySelector(".dropdown__toggle").style.paddingRight=""),this.$el.querySelector(".form__button--reset_search")?.remove(),this.partners.forEach((e=>e.component.hide())),this.partners.find((e=>"mainResult"===e.name)).component.show()})),e}class B{accept(e){return e(this),this}}class W extends B{constructor(e,t,s){let{perpage:n=25,page:i=1,counter:o={active:!1,selectorForInserts:"[data-sumbiot-page-counter]"}}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(),this.$paginationInElement=e.tagName?e:document.querySelector(e),this.$resultInElement=t.tagName?t:document.querySelector(t),this._listElements=s,this._countListElements=this._listElements.length||0,this._perpage=n,this._pagesCount=Math.ceil(this._countListElements/this._perpage)||1,this._page=i,o.active&&(this._counter=o),this._init()}_init(){this._switchPage()}_switchingHandler=e=>{e.preventDefault();let t=e.target;(t&&t.classList.contains("pagination__btn")||t&&t.parentElement.classList.contains("pagination__btn"))&&(t.parentElement.classList.contains("pagination__btn")&&(t=t.parentElement),this._switchPage(t))};_switchPage(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&(this._page=+e.dataset.page);let t=(this._page-1)*this._perpage,s=t+this._perpage,n=this._listElements.slice(t,s);this._counter&&this._counterPage(t,n),this.$resultInElement.innerHTML="",this.$resultInElement.append(...n),this._removeEventListenerClick(),this._pagesCount>1&&this._paginationCreate()}showPage(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._countListElements=this._listElements.length||0,this._pagesCount=Math.ceil(this._countListElements/this._perpage)||0,this._page=this._pagesCount<e?this._pagesCount:e<1?1:e,this._switchPage()}_paginationCreate(){const e=document.createElement("div");e.classList.add("pagination");let t=this._page>3?'<button type="button" class="pagination__btn" data-page="1">1</button>':"",s=this._page<this._pagesCount-2?`<button type="button" class="pagination__btn" data-page="${this._pagesCount}">${this._pagesCount}</button>`:"",n=this._page-4>1?'<span class="pagination__plug">...</span>':"",i=this._page-3>1?`<button type="button" class="pagination__btn" data-page="${this._page-3}">${this._page-3}</button>`:"",o=this._page-2>0?`<button type="button" class="pagination__btn" data-page="${this._page-2}">${this._page-2}</button>`:"",r=this._page-1>0?`<button type="button" class="pagination__btn" data-page="${this._page-1}">${this._page-1}</button>`:"",a=this._page+4<this._pagesCount?'<span class="pagination__plug">...</span>':"",l=this._page+3<this._pagesCount?`<button type="button" class="pagination__btn" data-page="${this._page+3}">${this._page+3}</button>`:"",c=this._page+2<=this._pagesCount?`<button type="button" class="pagination__btn" data-page="${this._page+2}">${this._page+2}</button>`:"",d=this._page+1<=this._pagesCount?`<button type="button" class="pagination__btn" data-page="${this._page+1}">${this._page+1}</button>`:"",u=`<button type="button" class="pagination__btn pagination__btn--active">${this._page}</button>`;e.innerHTML=t+n+i+o+r+u+d+c+l+a+s,this.$paginationInElement.append(e),this._addEventListenerClick()}_addEventListenerClick(){this.$paginationInElement.querySelectorAll(".pagination__btn").forEach((e=>{e.addEventListener("click",this._switchingHandler)}))}_removeEventListenerClick(){this.$paginationInElement.querySelectorAll(".pagination__btn").forEach((e=>{e.removeEventListener("click",this._switchingHandler)})),this.$paginationInElement.querySelector(".pagination")?.remove()}_counterPage(e,t){let s=e+1;t.forEach((e=>{e.querySelector(this._counter.selectorForInserts).innerHTML=s,s++}))}}function V(e){let{build:t=0,isAccess:s=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=document.createElement("div");n.classList.add("result__row","js-result-row");const i=`\n      <div class="row gx-0 js-accordion js-user-info">\n        ${S(e,{build:t,isAccess:s})}\n      </div>\x3c!--/.js-user-info--\x3e\n\n      <div class="result__info js-wrapper-modal">\n        ${L(e,{build:t,isAccess:s})}\n      </div>\x3c!--./result__info--\x3e\n  `;return n.insertAdjacentHTML("afterbegin",i),n}function X(e){return`\n    <div class="result__row js-result-row">\n      <div class="row gx-0 result__empty">\n        <div class="col-12 text-align-center d-block">\n          ${e}\n        </div>\n      </div>\n    </div>\x3c!--./result__row--\x3e\n  `}class J extends c{constructor(e,t){super(e,t),this.$pasteInElement=this.$el.querySelector(".result__inner"),this.data=null}register(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.data={result:e,...t},this}show(){this.$el.style.display="block",this._onShow()}_onShow(){this.data&&(Array.isArray(this.data.result)&&this.data.result.length?(this.html=this.data.result.map((e=>+e.customUser?V(e,{build:1,isAccess:this.data.isAccess}):+e.idMatrixWorks?V(e,{build:2,isAccess:this.data.isAccess}):V(e,{build:0,isAccess:this.data.isAccess}))),this.pagination=new W(this.$el,this.$pasteInElement,this.html,{counter:{active:!0,selectorForInserts:"[data-sumbiot-page-counter]"}})):(this.html=X("Найдено: 0 совпадений"),this.$pasteInElement.insertAdjacentHTML("afterbegin",this.html)),this.data=null)}_onHide(){this.$pasteInElement.innerHTML="",this.$el.querySelector(".pagination")?.remove()}removeElementInArray(e){if(this.html&&Array.isArray(this.html)){let t=this.html.findIndex((t=>t.querySelector("[data-sumbiot-page-counter]").dataset.id===e));-1!==t&&(this.html.splice(t,1),this.pagination.showPage(this.pagination._page))}}}class G extends c{constructor(e,t){super(e,t),this.$pasteInElement=this.$el.querySelector(".result__inner")}_init(){this.getAllUsers()}async getAllUsers(){const e=new g({loading:"Приложение загружается, подождите",success:"Приложение загружено, приятной работы",failure:"Приложение не загружено, что то пошло не так",activeClass:"loader--min-height"});let t,s=document.querySelectorAll(".top-panel__btn, .form__button");s.forEach((e=>{e.disabled=!0}));try{document.querySelector(".result").append(e.loading());let s=performance.now();t=await h.getAccessAdmin();let n=performance.now();console.log(`Запросы1 ${n-s} milliseconds`);let i=performance.now();const o=await h.getUsers();let r=performance.now();if(console.log(`Запросы2 ${i-r} milliseconds`),Array.isArray(o)&&o.length){let s=performance.now();this.html=o.map((e=>+e.customUser?V(e,{build:1,isAccess:t}):+e.idMatrixWorks?V(e,{build:2,isAccess:t}):V(e,{build:0,isAccess:t}))),e.success();let n=performance.now();console.log(`Массив ${n-s} milliseconds`),setTimeout((()=>{this.pagination=new W(this.$el,this.$pasteInElement,this.html,{counter:{active:!0,selectorForInserts:"[data-sumbiot-page-counter]"}})}),950)}else console.error("In file ResultMainComponent, in function getAllUsers, response is either not an array or an empty array")}catch(t){e.failure(),"error"===t.status?(console.group(`In file ApiService, in function ${t.functionName}, promise return reject`),console.group("List of errors"),t.errors.forEach((e=>{console.error(`Name: ${e.message}\n Code: ${e.code}\n customData: ${e.customData}`)})),console.groupEnd(),console.groupEnd()):(console.group("In file ResultMainComponent, in function getAllUsers error"),console.error(`${t.stack}`),console.groupEnd())}finally{setTimeout((()=>{e.removeLoader(),s.forEach((e=>{t&&(e.disabled=!1),t||e.classList.contains("js-isAccess")||(e.disabled=!1),!t&&e.classList.contains("js-isAccess")&&(e.classList.add("btn--disabled"),e.setAttribute("title","Нет прав доступа"),e.href&&e.removeAttribute("href"))}))}),900)}}unshift(e){if(e){let t=V(e,{build:1});this.html?(this.html.unshift(t),this.pagination.showPage(1)):this.$pasteInElement.insertAdjacentElement("afterbegin",t)}return this}removeElementInArray(e){if(this.html&&Array.isArray(this.html)){let t=this.html.findIndex((t=>t.querySelector("[data-sumbiot-page-counter]").dataset.id===e));-1!==t&&(this.html.splice(t,1),this.pagination.showPage(this.pagination._page))}}}class K extends c{constructor(e,t){super(e,t),this.$pasteInElement=this.$el.querySelector(".result__inner")}register(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.data={result:e,...t},this}show(){this.$el.style.display="block",this._onShow()}_onShow(){this.data&&(Array.isArray(this.data.result)&&this.data.result.length?(this.html=this.data.result.map((e=>+e.customUser?V(e,{build:1,isAccess:this.data.isAccess}):+e.idMatrixWorks?V(e,{build:2,isAccess:this.data.isAccess}):V(e,{build:0,isAccess:this.data.isAccess}))),setTimeout((()=>{this.pagination=new W(this.$el,this.$pasteInElement,this.html,{counter:{active:!0,selectorForInserts:"[data-sumbiot-page-counter]"}})}),950)):(this.html=X("Ваш запрос не дал результатов"),setTimeout((()=>{this.$pasteInElement.insertAdjacentHTML("afterbegin",this.html),this.$el.querySelector(".text-align-center")?.append(this.data.bntNext)}),950)),setTimeout((()=>{this.data=null}),1e3))}_onHide(){this.$pasteInElement.innerHTML="",this.$el.querySelector(".pagination")?.remove()}removeElementInArray(e){if(this.html&&Array.isArray(this.html)){let t=this.html.findIndex((t=>t.querySelector("[data-sumbiot-page-counter]").dataset.id===e));-1!==t&&(this.html.splice(t,1),this.pagination.showPage(this.pagination._page))}}}class Y{constructor(e,t,s){this._panelsElements=document.querySelectorAll(e),this._stretchSelector=t,this._activeClass=s,this._init()}_init(){this._stretchHandler()}_stretchHandler(){this._panelsElements.forEach((e=>{let t=e.querySelector(".option-panel__item--stretch");t?.addEventListener("click",(s=>{s.preventDefault(),this._toggle(e,t)}))}))}_toggle(e,t){e.closest(this._stretchSelector).classList.toggle(this._activeClass),t.classList.toggle("option-panel__item--stretch-off"),"развернуть"===t.title.toLowerCase()?t.setAttribute("title","Свернуть"):t.setAttribute("title","Развернуть")}}class z{constructor(e,t){this._panelsElements=document.querySelectorAll(e),this._searchSelector=t,this._init()}_init(){this._searchHandler()}_searchHandler(){this._panelsElements.forEach((e=>{let t=e.parentElement,s=e.querySelector(".option-panel__item--search"),n=t.querySelector(".dropdown__search"),i=t.querySelector(".dropdown__search-reset");s?.addEventListener("click",(e=>{e.preventDefault(),this._toggleSearch(t,n)})),n?.addEventListener("input",(e=>{e.preventDefault(),this._searchOptions(t,n)})),n?.addEventListener("keydown",(e=>{13===e.keyCode&&e.preventDefault()})),n?.addEventListener("paste",(e=>{e.preventDefault(),n.innerText=e.clipboardData.getData("text/plain"),this._searchOptions(t,n)})),i?.addEventListener("click",(e=>{e.preventDefault(),this._reset(t,n)})),t.addEventListener("click",(e=>{const s=e.target;(s&&s.classList.contains("dropdown__item")||s&&s.parentElement.classList.contains("dropdown__item"))&&this._reset(t,n)}))}))}_toggleSearch(e,t){let s=e.querySelector(this._searchSelector),n=e.querySelectorAll(".dropdown__item"),i=t.nextElementSibling;s.hidden?(s.hidden=!1,t.focus()):(s.hidden=!0,t.innerText="",n.forEach((e=>{e.style.display="block"})),i.hidden=!0,i.nextElementSibling.hidden=!0)}_searchOptions(e,t){let s=!1,n=t.innerText.trim(),i=e.querySelectorAll(".dropdown__item"),o=t.nextElementSibling;o.hidden=!0,n?(o.nextElementSibling.hidden=!1,i.forEach((e=>{e.innerText.toUpperCase().includes(n.toUpperCase())?(e.style.display="block",s=!0):e.style.display="none"})),s||(o.hidden=!1)):(o.nextElementSibling.hidden=!0,i.forEach((e=>{e.style.display="block"})))}_reset(e,t){e.querySelectorAll(".dropdown__item").forEach((e=>{e.style.display="block"})),t.innerText="",t.nextElementSibling.hidden=!0,t.nextElementSibling.nextElementSibling.hidden=!0}}class Q{static modalsUnityMod(e){e.upgrade=function(){const e=e=>{let t=e.innerText;this.modal.querySelector(".modal__title").innerText=`${t||"Редактировать"} удостоверение`},t=e=>{this.modal.querySelector("form").action=e.dataset.action||""},s=e=>{if(e.dataset.idUser){const t=document.createElement("input");t.classList.add("js-input-user-id"),t.setAttribute("type","hidden"),t.setAttribute("name","ID_USER"),t.setAttribute("value",e.dataset.idUser),this.modal.querySelector("form").prepend(t)}if(e.dataset.customUser){const t=document.createElement("input");t.classList.add("js-input-custom-user"),t.setAttribute("type","hidden"),t.setAttribute("name","CUSTOM_USER"),t.setAttribute("value",e.dataset.customUser),this.modal.querySelector("form").prepend(t)}},n=()=>{const e=this.modal.querySelectorAll("input");for(let t of e)(t.classList.contains("js-input-user-id")||t.classList.contains("js-input-custom-user"))&&t.remove()};document.addEventListener("click",(i=>{let o=i.target;(o&&o.classList.contains(this._trigger.slice(1))||o.parentElement.classList.contains(this._trigger.slice(1)))&&(o.parentElement.classList.contains(this._trigger.slice(1))&&(o=o.parentElement),w.removeClass(".js-wrapper-modal",["result__info--min_height-380","result__info--min_height-442","result__info--min_height-265"]),w.addClosestClass(o,".js-wrapper-modal",["result__info--min_height-380"]),n(),e(o),t(o),s(o))})),this._close.addEventListener("click",(e=>{w.removeClosestClass(e.target,".js-wrapper-modal",["result__info--min_height-380"])})),window.addEventListener("keydown",(e=>{"Escape"!==e.key&&27!==e.keyCode||w.removeClass(".js-wrapper-modal",["result__info--min_height-380","result__info--min_height-442","result__info--min_height-265"])}))}}static modalsStandardMod(e){e.upgrade=function(){document.addEventListener("click",(e=>{let t=e.target;t&&t.classList.contains(this._trigger.slice(1))||t&&t.parentElement.classList.contains(this._trigger.slice(1))}))}}static editUserMod(e){e.upgrade=function(){document.addEventListener("click",(e=>{let t=e.target;(t&&t.classList.contains(this._trigger.slice(1))||t.parentElement.classList.contains(this._trigger.slice(1)))&&(t.parentElement.classList.contains(this._trigger.slice(1))&&(t=t.parentElement),w.removeClass(".js-wrapper-modal",["result__info--min_height-380","result__info--min_height-442","result__info--min_height-265"]),w.addClosestClass(t,".js-wrapper-modal",["result__info--min_height-442"]))})),this._close.addEventListener("click",(e=>{w.removeClosestClass(e.target,".js-wrapper-modal",["result__info--min_height-442"])}))}}static modalsUnityDeleteMod(e){e.upgrade=function(){const e=e=>{this.modal.querySelector("form").action=e.dataset.action||""},t=e=>{if(e.dataset.idUser){const t=document.createElement("input");t.classList.add("js-input-user-id"),t.setAttribute("type","hidden"),t.setAttribute("name","ID_USER"),t.setAttribute("value",e.dataset.idUser),this.modal.querySelector("form").prepend(t)}if(e.dataset.customUser){const t=document.createElement("input");t.classList.add("js-input-custom-user"),t.setAttribute("type","hidden"),t.setAttribute("name","CUSTOM_USER"),t.setAttribute("value",e.dataset.customUser),this.modal.querySelector("form").prepend(t)}},s=()=>{const e=this.modal.querySelectorAll("input");for(let t of e)(t.classList.contains("js-input-user-id")||t.classList.contains("js-input-custom-user"))&&t.remove()};document.addEventListener("click",(n=>{let i=n.target;(i&&i.classList.contains(this._trigger.slice(1))||i.parentElement.classList.contains(this._trigger.slice(1)))&&(i.parentElement.classList.contains(this._trigger.slice(1))&&(i=i.parentElement),w.removeClass(".js-wrapper-modal",["result__info--min_height-380","result__info--min_height-442","result__info--min_height-265"]),s(),e(i),t(i))}))}}static addHseMod(e){e.upgrade=function(e){const t=e=>{window.innerHeight-e.clientY<210?this.modal.classList.add("modal--position-top"):this.modal.classList.remove("modal--position-top")};document.addEventListener("click",(s=>{let n=s.target;(n&&n.classList.contains(this._trigger.slice(1))||n.parentElement.classList.contains(this._trigger.slice(1)))&&(s.stopPropagation(),w.removeClass(".js-wrapper-modal",["result__info--min_height-380","result__info--min_height-442","result__info--min_height-265"]),e.reset(this.modal.querySelector("#add-hse")),t(s))}),!0)}}static editHseMod(e){e.upgrade=function(){document.addEventListener("click",(e=>{let t=e.target;(t&&t.classList.contains(this._trigger.slice(1))||t.parentElement.classList.contains(this._trigger.slice(1)))&&(t.parentElement.classList.contains(this._trigger.slice(1))&&(t=t.parentElement),w.removeClass(".js-wrapper-modal",["result__info--min_height-380","result__info--min_height-442","result__info--min_height-265"]),w.addClosestClass(t,".js-wrapper-modal",["result__info--min_height-265"]))})),this._close.addEventListener("click",(e=>{w.removeClosestClass(e.target,".js-wrapper-modal",["result__info--min_height-265"])}))}}static positionMod(e){e.upgrade=function(){document.querySelectorAll(".js-dropdown__toggle").forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault(),((e,t)=>{document.documentElement.scrollHeight-t.pageY<400?e.nextElementSibling.classList.add("dropdown__options--top-position"):e.nextElementSibling.classList.remove("dropdown__options--top-position")})(e,t)}))}))}}static accordionParentMod(e){e.upgrade=function(){const e=e=>{document.querySelectorAll(this._triggerSelector).forEach((t=>{t===e.closest(this._triggerSelector)?e.closest(this._triggerSelector).parentElement.classList.toggle("result__row--active"):t.parentElement.classList.remove("result__row--active")}))};document.addEventListener("click",(t=>{const s=t.target;s&&s.closest(this._triggerSelector)&&e(s)}))}}}window.addEventListener("DOMContentLoaded",(()=>{const e=new a(".dropdown--select",{dropdownToggleSelector:".dropdown__toggle",dropdownOptionsWrapperSelector:".dropdown--select .dropdown__options",dropdownOptionSelector:".dropdown__item"});e.accept(Q.positionMod).upgrade(),new l(".dropdown--input",{dropdownToggleSelector:".dropdown__toggle",dropdownOptionsWrapperSelector:".dropdown--input .dropdown__options",dropdownOptionSelector:".dropdown__item"}),new Y(".js-option-panel",".dropdown__options","dropdown__options--stretch"),new z(".js-option-panel",".dropdown__search-box"),new t(".js-filter-modal",{modalGroup:"[data-sumbiot-modal-top]",closeClickOverlay:!1}).accept(Q.modalsStandardMod).upgrade(),new t(".js-add-user-modal",{modalGroup:"[data-sumbiot-modal-top]",closeClickOverlay:!1}).accept(Q.modalsStandardMod).upgrade(),new s(".js-edit-user-modal",{modalSelector:"#edit-user-modal",modalWrapper:".js-wrapper-modal",closeClickOverlay:!1}).accept(Q.editUserMod).upgrade(),new s(".js-delete-user-and-card-modal",{modalSelector:"#delete-user-or-card-modal",closeClickOverlay:!1}).accept(Q.modalsUnityDeleteMod).upgrade(),new s(".js-edit-card-modal",{modalSelector:"#edit-card-modal",modalWrapper:".js-wrapper-modal",closeClickOverlay:!1}).accept(Q.modalsUnityMod).upgrade(),new s(".js-add-hse-modal",{modalSelector:"#add-hse-modal",closeClickOverlay:!1}).accept(Q.addHseMod).upgrade(e),new s(".js-edit-hse-modal",{modalSelector:"#edit-hse-modal",modalWrapper:".js-wrapper-modal",closeClickOverlay:!1}).accept(Q.editHseMod).upgrade(),new i(".js-accordion",{contentActive:"result__info--active",display:"grid"}).accept(Q.accordionParentMod).upgrade();const n=new G("#main-result"),o=new J("#filter-result"),r=new K("#search-result");new f("#add-user",{dropDown:e,partners:[{name:"mainResult",component:n},{name:"filterResult",component:o},{name:"searchResult",component:r}]}),new D("#edit-user",{dropDown:e}),new T("#edit-card"),new q("#delete-user-or-card",{partners:[{name:"mainResult",component:n},{name:"filterResult",component:o},{name:"searchResult",component:r}]}),new O("#add-hse"),new O("#edit-hse"),new b("#filter",{dropDown:e,partners:[{name:"mainResult",component:n},{name:"filterResult",component:o},{name:"searchResult",component:r}]}),new U("#search-otipb",{partners:[{name:"mainResult",component:n},{name:"filterResult",component:o},{name:"searchResult",component:r}]})}))}();
//# sourceMappingURL=main.js.map